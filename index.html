<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Stock Correlation & Stress App</title>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<style>
		:root {
			--bg: #0b1220;
			--card: #121a2b;
			--muted: #8aa0c6;
			--accent: #4f83ff;
			--good: #00c853;
			--bad: #ff5252;
		}
		* { box-sizing: border-box; }
		body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:#e6edf7; }
		header { padding:24px 16px; border-bottom:1px solid #1e2a44; position:sticky; top:0; background:linear-gradient(180deg, #0b1220 0%, #0b1220cc 100%); backdrop-filter: blur(6px); z-index:10; }
		.container { max-width:1200px; margin:0 auto; padding:16px; }
		h1 { margin:0 0 8px 0; font-size:22px; }
		.subtitle { color:var(--muted); font-size:13px; }
		.controls { display:grid; grid-template-columns: repeat(6, minmax(120px, 1fr)); gap:10px; margin-top:16px; }
		.control { display:flex; flex-direction:column; gap:6px; background:var(--card); padding:10px; border:1px solid #1e2a44; border-radius:10px; }
		.control label { font-size:12px; color:var(--muted); }
		.control input, .control select { background:#0c1424; color:#e6edf7; border:1px solid #253555; border-radius:8px; padding:8px 10px; font-size:14px; }
		.label-with-help { display:flex; align-items:center; gap:6px; position:relative; font-size:12px; }
		.label-with-help label { margin:0; color:var(--muted); }
		.label-with-help span { font-size:inherit; color:inherit; }
		.help-icon { background:rgba(79,131,255,0.16); border:1px solid rgba(79,131,255,0.5); border-radius:50%; width:18px; height:18px; display:flex; align-items:center; justify-content:center; color:var(--accent); font-size:12px; font-weight:600; cursor:pointer; transition:all 0.12s ease; padding:0; }
		.help-icon:hover, .help-icon:focus { background:rgba(79,131,255,0.3); border-color:var(--accent); outline:none; color:white; }
		.help-icon:focus-visible { outline:2px solid var(--accent); outline-offset:2px; }
		.help-tooltip { position:absolute; top:calc(100% + 8px); right:0; background:#0c1424; border:1px solid #2a3a5d; box-shadow:0 12px 28px rgba(6,10,24,0.55); border-radius:10px; padding:12px; max-width:280px; color:#d8e2ff; font-size:12px; line-height:1.5; opacity:0; pointer-events:none; transform:translateY(-6px); transition:opacity 0.14s ease, transform 0.14s ease; z-index:40; }
		.label-with-help:hover .help-tooltip, .help-icon:focus + .help-tooltip, .help-icon:hover + .help-tooltip { opacity:1; pointer-events:auto; transform:translateY(0); }
		.card-heading { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px; color:#dbe6ff; font-size:14px; font-weight:600; }
		.btn { align-self:end; background:var(--accent); color:white; border:none; border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer; }
		.btn:disabled { opacity:0.6; cursor:not-allowed; }
		/* Ensure clicks are never blocked by overlays */
		header, .btn { pointer-events: auto; }
		.row { display:grid; grid-template-columns: 1fr; gap:16px; margin-top:16px; }
		@media (min-width: 900px){ .row { grid-template-columns: 1fr 1fr; } }
		.card { background:var(--card); border:1px solid #1e2a44; border-radius:14px; padding:12px; }
		.stats { display:grid; grid-template-columns: repeat(6, 1fr); gap:10px; }
		.stat { background:#0c1424; border:1px solid #253555; border-radius:12px; padding:12px; }
		.stat .label { font-size:12px; color:var(--muted); }
		.stat .value { font-size:18px; font-weight:700; margin-top:6px; }
		/* Compact stats layout for tighter, wider boxes (used bottom-right) */
		.stats.stats-compact { grid-template-columns: repeat(2, minmax(220px, 1fr)); }
		.stats.stats-compact .stat { padding:10px; }
		.stats.stats-compact .stat .label { font-size:11px; }
		.stats.stats-compact .stat .value { font-size:16px; white-space: nowrap; }
		@media (max-width: 700px){
			.stats.stats-compact { grid-template-columns: 1fr; }
		}
		.status { margin-top:10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace; color:#c7d2e6; }
		.status.error { color: var(--bad); }
		.grid-1 { display:grid; grid-template-columns: 1fr; gap:16px; }
		.chart { height:360px; }
		.autocomplete { position: relative; }
		.autocomplete input { position: relative; z-index: 2; }
		.autocomplete-list { position:absolute; top:calc(100% + 4px); left:0; background:#0c1424; border:1px solid #253555; border-radius:10px; box-shadow:0 18px 36px rgba(10,16,30,0.55); max-height:260px; overflow-y:auto; padding:4px 0; z-index:30; min-width:100%; width:clamp(360px, 52vw, 720px); max-width:calc(100vw - 32px); }
		.autocomplete-list.hidden { display:none; }
		.autocomplete-item { display:grid; grid-template-columns: minmax(90px, 1fr) minmax(180px, 1.4fr) minmax(120px, auto); gap:8px; align-items:center; padding:8px 12px; cursor:pointer; font-size:13px; transition:background 0.12s ease; }
		.autocomplete-item:hover, .autocomplete-item.active { background:#1a2440; }
		.autocomplete-symbol { font-weight:600; color:var(--accent); white-space:nowrap; }
		.autocomplete-alias { margin-left:6px; color:var(--muted); font-size:11px; text-transform:uppercase; letter-spacing:0.8px; font-weight:500; }
		.autocomplete-name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:#d6e0f5; }
		.autocomplete-meta { display:flex; flex-wrap:wrap; gap:6px 10px; align-items:center; font-variant-numeric:tabular-nums; }
		.autocomplete-exchange { color:var(--muted); font-size:12px; }
		.autocomplete-price { color:#e6edf7; font-weight:600; }
		.autocomplete-change { font-weight:600; }
		.autocomplete-change.positive { color:var(--good); }
		.autocomplete-change.negative { color:var(--bad); }
		.autocomplete-empty { padding:8px 12px; color:var(--muted); font-size:13px; }
	</style>
</head>
<body>
	<header>
		<div class="container">
			<h1>Stock Correlation & Stress App</h1>
			<div class="subtitle">Compare two tickers, compute correlations and stress impacts, and visualize results.</div>
			<div class="controls">
				<div class="control autocomplete">
					<div class="label-with-help">
						<label for="tickerA">Ticker A</label>
						<button type="button" class="help-icon" aria-label="What is Ticker A?">?</button>
						<div class="help-tooltip">Primary ticker you want to stress. We'll fetch its price history and apply the shock directly to this series.</div>
					</div>
					<input id="tickerA" value="GOOGL" />
				</div>
				<div class="control autocomplete">
					<div class="label-with-help">
						<label for="tickerB">Ticker B</label>
						<button type="button" class="help-icon" aria-label="What is Ticker B?">?</button>
						<div class="help-tooltip">Comparison ticker. We measure how this asset co-moves with Ticker A to estimate correlation, beta and stress impacts.</div>
					</div>
					<input id="tickerB" value="AAPL" />
				</div>
				<div class="control">
					<div class="label-with-help">
						<label for="start">Start</label>
						<button type="button" class="help-icon" aria-label="What does the start date do?">?</button>
						<div class="help-tooltip">Earliest trading date used when we pull daily closes. Go back far enough to capture the market regimes you're testing.</div>
					</div>
					<input id="start" type="date" value="2023-01-01" />
				</div>
				<div class="control">
					<div class="label-with-help">
						<label for="end">End</label>
						<button type="button" class="help-icon" aria-label="What does the end date do?">?</button>
						<div class="help-tooltip">Latest trading date in the sample. Stopping near today keeps the outputs aligned with the latest market moves.</div>
					</div>
					<input id="end" type="date" value="2025-09-29" />
				</div>
				<div class="control">
					<div class="label-with-help">
						<label for="shock">Shock to A (%)</label>
						<button type="button" class="help-icon" aria-label="How is the shock to A used?">?</button>
						<div class="help-tooltip">Stress shock in percent applied to Ticker A's log return path. Positive values mean an upside move; negative values create a sell-off scenario.</div>
					</div>
					<input id="shock" type="number" value="5" step="0.1" />
				</div>
				<div class="control">
					<div class="label-with-help">
						<label for="window">Rolling window (days)</label>
						<button type="button" class="help-icon" aria-label="What is the rolling window?">?</button>
						<div class="help-tooltip">Size of the rolling window (trading days) for correlations and betas. If this exceeds the age of the youngest public company in the portfolio, the tail of the chart is extrapolated and becomes less reliable.</div>
					</div>
					<input id="window" type="number" value="30" min="5" step="1" />
				</div>
				<button id="run" class="btn" type="button">Run</button>
			</div>
			<div id="status" class="status">Ready.</div>
		</div>
	</header>
	<main class="container">
				<div class="card" style="margin-bottom:16px">
					<div class="controls" style="grid-template-columns: repeat(8, minmax(120px, 1fr));">
						<div class="control">
							<div class="label-with-help">
								<label for="mode">Simulation mode</label>
								<button type="button" class="help-icon" aria-label="What does simulation mode change?">?</button>
								<div class="help-tooltip">Choose how to generate joint return paths. Conditional keeps B tied to A via the regression. Joint Normal assumes correlated Gaussian returns. Joint Student-t adds heavier tails for stress testing.</div>
							</div>
							<select id="mode">
								<option value="conditional">Conditional (B | A shock)</option>
								<option value="normal">Joint Normal</option>
								<option value="t">Joint Student-t</option>
							</select>
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="nu">t degrees of freedom</label>
								<button type="button" class="help-icon" aria-label="How do t degrees of freedom work?">?</button>
								<div class="help-tooltip">Only used for the Student-t simulation. Lower degrees of freedom thicken the tails, meaning more extreme moves are sampled during the Monte Carlo.</div>
							</div>
							<input id="nu" type="number" value="5" min="3" step="1" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="scenario">Scenario</label>
								<button type="button" class="help-icon" aria-label="What does the scenario do?">?</button>
								<div class="help-tooltip">Select a historical stress window to re-use its return distribution, or pick Worst-k to stitch together the harshest days from Ticker A.</div>
							</div>
							<select id="scenario">
								<option value="none">None</option>
								<option value="2008">GFC 2008-09-01→2009-03-31</option>
								<option value="covid">COVID 2020-02-15→2020-04-15</option>
								<option value="worstk">Worst-k days (A)</option>
							</select>
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="worstk">Worst-k (days)</label>
								<button type="button" class="help-icon" aria-label="How is worst-k used?">?</button>
								<div class="help-tooltip">If you choose the Worst-k scenario we rank Ticker A's drawdowns and stitch together this many of the most painful days to build the stress path.</div>
							</div>
							<input id="worstk" type="number" value="10" min="1" step="1" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="volModel">Vol model</label>
								<button type="button" class="help-icon" aria-label="What does the vol model control?">?</button>
								<div class="help-tooltip">Static keeps volatility fixed at the sample level. EWMA adapts volatility through time using an exponential weighting scheme, letting recent moves hit harder.</div>
							</div>
							<select id="volModel">
								<option value="static">Static</option>
								<option value="ewma">EWMA</option>
							</select>
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="lambda">EWMA lambda</label>
								<button type="button" class="help-icon" aria-label="How does EWMA lambda work?">?</button>
								<div class="help-tooltip">Decay factor for the EWMA volatility update. Higher lambda means slower decay, so history lingers longer; lower lambda reacts faster to new moves.</div>
							</div>
							<input id="lambda" type="number" value="0.94" min="0.5" max="0.99" step="0.01" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="bench">Benchmark ticker</label>
								<button type="button" class="help-icon" aria-label="What is the benchmark ticker?">?</button>
								<div class="help-tooltip">Optional benchmark used when calculating the portfolio view. Pick an index or ETF you’d like to track alongside the pair.</div>
							</div>
							<input id="bench" value="^GSPC" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="benchShock">Benchmark shock (%)</label>
								<button type="button" class="help-icon" aria-label="How is benchmark shock applied?">?</button>
								<div class="help-tooltip">Add an extra stress shock to the benchmark series. Useful for aligning the portfolio stress with headline index moves.</div>
							</div>
							<input id="benchShock" type="number" value="0" step="0.1" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="wA">Weight A</label>
								<button type="button" class="help-icon" aria-label="How is Weight A used?">?</button>
								<div class="help-tooltip">Portfolio weight for Ticker A when we combine A and B to show stressed portfolio quantiles.</div>
							</div>
							<input id="wA" type="number" value="0.5" step="0.01" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="wB">Weight B</label>
								<button type="button" class="help-icon" aria-label="How is Weight B used?">?</button>
								<div class="help-tooltip">Portfolio weight for Ticker B. We renormalise A and B weights when calculating the portfolio statistics.</div>
							</div>
							<input id="wB" type="number" value="0.5" step="0.01" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="cap">Return cap</label>
								<button type="button" class="help-icon" aria-label="What is the return cap?">?</button>
								<div class="help-tooltip">Optional ceiling for simulated daily returns (in decimal form). Use it to clip extreme upside moves created by the Monte Carlo.</div>
							</div>
							<input id="cap" type="number" value="" placeholder="e.g. 0.1" />
						</div>
						<div class="control">
							<div class="label-with-help">
								<label for="floor">Return floor</label>
								<button type="button" class="help-icon" aria-label="What is the return floor?">?</button>
								<div class="help-tooltip">Optional floor for simulated daily returns (in decimal form). Handy when you want to guard against unrealistically large down moves.</div>
							</div>
							<input id="floor" type="number" value="" placeholder="e.g. -0.1" />
						</div>
					</div>
				</div>
		<div class="card">
			<div class="stats">
				<div class="stat">
					<div class="label label-with-help">
						<span>Overlap Days</span>
						<button type="button" class="help-icon" aria-label="What are overlap days?">?</button>
						<div class="help-tooltip">Count of trading days shared by both tickers. Every statistic below uses only these overlapping observations.</div>
					</div>
					<div id="s-overlap" class="value">-</div>
				</div>
				<div class="stat">
					<div class="label label-with-help">
						<span>Pearson r</span>
						<button type="button" class="help-icon" aria-label="What is Pearson r?">?</button>
						<div class="help-tooltip">Linear correlation coefficient between the log returns of Ticker A and Ticker B. +1 moves together, -1 moves opposite.</div>
					</div>
					<div id="s-r" class="value">-</div>
				</div>
				<div class="stat">
					<div class="label label-with-help">
						<span>Beta (B on A)</span>
						<button type="button" class="help-icon" aria-label="What does beta mean here?">?</button>
						<div class="help-tooltip">Regression slope: expected daily return change in Ticker B for a one unit move in Ticker A.</div>
					</div>
					<div id="s-beta" class="value">-</div>
				</div>
				<div class="stat">
					<div class="label label-with-help">
						<span>Alpha</span>
						<button type="button" class="help-icon" aria-label="What is alpha?">?</button>
						<div class="help-tooltip">Regression intercept of B on A expressed in daily log-return units. Persistent positive alpha hints at structural outperformance.</div>
					</div>
					<div id="s-alpha" class="value">-</div>
				</div>
				<div class="stat">
					<div class="label label-with-help">
						<span>Vol A / Vol B</span>
						<button type="button" class="help-icon" aria-label="How is the volatility ratio used?">?</button>
						<div class="help-tooltip">Sample standard deviation of daily log returns. Compare the scale of moves between the two tickers.</div>
					</div>
					<div id="s-vol" class="value">-</div>
				</div>
				<div class="stat">
					<div class="label label-with-help">
						<span>Covariance</span>
						<button type="button" class="help-icon" aria-label="What is covariance?">?</button>
						<div class="help-tooltip">Sample covariance between daily log returns. Positive values mean they tend to move together; negative means opposite.</div>
					</div>
					<div id="s-cov" class="value">-</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="card">
				<div class="card-heading label-with-help">
					<span>Indexed price paths</span>
					<button type="button" class="help-icon" aria-label="How should I read the price paths?">?</button>
					<div class="help-tooltip">Each price series is rebased to 100 at the first overlapping date so you can compare relative performance and drawdowns side by side.</div>
				</div>
				<div id="ts_prices" class="chart"></div>
			</div>
			<div class="card">
				<div class="card-heading label-with-help">
					<span>Return scatter</span>
					<button type="button" class="help-icon" aria-label="How should I read the scatter plot?">?</button>
					<div class="help-tooltip">Each point is a daily log return pair (A on the x-axis, B on the y-axis). The slope and spread show beta and residual volatility.</div>
				</div>
				<div id="scatter" class="chart"></div>
			</div>
		</div>

		<div class="row">
			<div class="card">
				<div class="card-heading label-with-help">
					<span>Rolling metrics</span>
					<button type="button" class="help-icon" aria-label="What does the rolling chart show?">?</button>
					<div class="help-tooltip">Rolling correlations and betas computed over your chosen window. If the window is longer than the history of the youngest public company in the pair, the tail end relies on extrapolation and becomes less reliable.</div>
				</div>
				<div id="rolling" class="chart"></div>
			</div>
			<div class="card">
				<div class="card-heading label-with-help">
					<span>Monte Carlo stress</span>
					<button type="button" class="help-icon" aria-label="How does the Monte Carlo work?">?</button>
					<div class="help-tooltip">Simulated price paths for Ticker B given the shock to Ticker A and your model settings. The horizon matches the rolling window—if that exceeds the age of the youngest public company in the portfolio, anything beyond the data history is extrapolated and less accurate.</div>
				</div>
				<div class="grid-1">
					<div id="mc" class="chart"></div>
					<div class="stats stats-compact">
						<div class="stat">
							<div class="label label-with-help">
								<span>Expected B (shock)</span>
								<button type="button" class="help-icon" aria-label="What is expected B?">?</button>
								<div class="help-tooltip">Conditional expected return for Ticker B once the shock is applied to Ticker A, using the regression pass-through.</div>
							</div>
							<div id="s-expB" class="value">-</div>
						</div>
						<div class="stat">
							<div class="label label-with-help">
								<span>MC p5 / p50 / p95</span>
								<button type="button" class="help-icon" aria-label="What are the Monte Carlo quantiles?">?</button>
								<div class="help-tooltip">5th, 50th and 95th percentile of Ticker B returns across the Monte Carlo simulation paths.</div>
							</div>
							<div id="s-quant" class="value">-</div>
						</div>
						<div class="stat">
							<div class="label label-with-help">
								<span>Samples</span>
								<button type="button" class="help-icon" aria-label="What are samples?">?</button>
								<div class="help-tooltip">Number of Monte Carlo paths generated for the simulation. More samples give smoother quantiles but take longer to compute.</div>
							</div>
							<div id="s-samples" class="value">-</div>
						</div>
						<div class="stat">
							<div class="label label-with-help">
								<span>Portfolio p5 / p50 / p95</span>
								<button type="button" class="help-icon" aria-label="What are the portfolio quantiles?">?</button>
								<div class="help-tooltip">5th, 50th and 95th percentile of the weighted A/B portfolio once the benchmark and weights are applied.</div>
							</div>
							<div id="s-quant-port" class="value">-</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script src="main.js?v=20251003a" defer></script>
</body>
</html>